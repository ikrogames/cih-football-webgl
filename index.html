<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Unity WebGL Player | CIHFOOT</title>
    <link rel="shortcut icon" href="TemplateData/favicon.ico" />
    <link rel="stylesheet" href="TemplateData/style.css" />

    <!-- Firebase SDK (compat version) | KEEP -->
    <script src="https://www.gstatic.com/firebasejs/9.14.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.14.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.14.0/firebase-firestore-compat.js"></script>

    <script>
        // Firebase config | KEEP
        const firebaseConfig = {
            apiKey: "AIzaSyB0qaD4Ct5cp3Wjcp1485ij8gSfLVf44dY",
            authDomain: "cih-football.firebaseapp.com",
            projectId: "cih-football",
            storageBucket: "cih-football.firebasestorage.app",
            messagingSenderId: "718160665278",
            appId: "1:718160665278:web:524d891d0de2aa69121cef",
            measurementId: "G-34EH7DVHBH",
        };
        const firebaseApp = firebase.initializeApp(firebaseConfig);
        const auth = firebaseApp.auth();
    </script>

    <style>
        html, body { margin: 0; height: 100%; background: #fff; }

        /* Desktop: center fixed canvas size */
        #unity-container {
            width: 100vw; height: 100vh;
            display: flex; align-items: center; justify-content: center;
            position: relative; background: #fff;
        }

        /* Footer pinned to bottom (hidden on touch devices via @media) */
        #unity-footer {
            position: absolute; left: 0; right: 0; bottom: 0;
            display: flex; justify-content: center;
            pointer-events: none; padding: 0 12px 8px;
        }
        #unity-footer > * { pointer-events: auto; }

        /* Mobile: full-bleed when class is present */
        #unity-container.unity-mobile,
        #unity-canvas.unity-mobile {
            width: 100vw; height: 100vh; display: block;
        }

        /* Hide footer on touch devices */
        @media (pointer: coarse) {
            #unity-footer { display: none !important; }
        }

        /* Optional: iOS safe-area padding */
        .pad-safe {
            padding: env(safe-area-inset-top) env(safe-area-inset-right)
            env(safe-area-inset-bottom) env(safe-area-inset-left);
        }
    </style>
</head>
<body>
<div id="unity-container" class="unity-desktop pad-safe">
    <canvas id="unity-canvas" width="960" height="600" tabindex="-1"></canvas>

    <div id="unity-loading-bar">
        <div id="unity-logo"></div>
        <div id="unity-progress-bar-empty">
            <div id="unity-progress-bar-full"></div>
        </div>
    </div>

    <div id="unity-warning"></div>

    <div id="unity-footer">
        <div id="unity-webgl-logo"></div>
        <div id="unity-fullscreen-button"></div>
        <div id="unity-build-title">CIHFOOT</div>
    </div>
</div>

<script>
    // --- Basic Unity template wiring ---
    const container = document.getElementById("unity-container");
    const canvas = document.getElementById("unity-canvas");
    const loadingBar = document.getElementById("unity-loading-bar");
    const progressBarFull = document.getElementById("unity-progress-bar-full");
    const fullscreenButton = document.getElementById("unity-fullscreen-button");
    const warningBanner = document.getElementById("unity-warning");

    function unityShowBanner(msg, type) {
        function updateBannerVisibility() {
            warningBanner.style.display = warningBanner.children.length ? "block" : "none";
        }
        const div = document.createElement("div");
        div.innerHTML = msg;
        warningBanner.appendChild(div);
        if (type === "error") div.style = "background: red; padding: 10px;";
        else {
            if (type === "warning") div.style = "background: yellow; padding: 10px;";
            setTimeout(() => { warningBanner.removeChild(div); updateBannerVisibility(); }, 5000);
        }
        updateBannerVisibility();
    }

    // Build paths (update names if your build output differs)
    const buildUrl = "Build";
    const loaderUrl = buildUrl + "/CIHTest.loader.js";
    const config = {
        dataUrl: buildUrl + "/CIHTest.data",
        frameworkUrl: buildUrl + "/CIHTest.framework.js",
        codeUrl: buildUrl + "/CIHTest.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "IkroGames",
        productName: "CIHFOOT",
        productVersion: "0.1",
        showBanner: unityShowBanner
    };

    // Mobile vs Desktop sizing
    if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
        const meta = document.createElement("meta");
        meta.name = "viewport";
        meta.content = "width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes";
        document.head.appendChild(meta);
        container.classList.remove("unity-desktop");
        container.classList.add("unity-mobile");
        canvas.classList.add("unity-mobile");
        // Optional perf tweak:
        // config.devicePixelRatio = 1;
    } else {
        // Desktop: keep fixed 960x600; container centers it
        canvas.style.width = "960px";
        canvas.style.height = "600px";
    }

    loadingBar.style.display = "block";

    // Desktop footer â†’ fullscreen the container
    function requestContainerFullscreen() {
        const el = document.getElementById("unity-container");
        if (!el) return;
        if (el.requestFullscreen) el.requestFullscreen();
        else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen(); // Safari
    }

    const script = document.createElement("script");
    script.src = loaderUrl;
    script.onload = () => {
        createUnityInstance(canvas, config, (progress) => {
            progressBarFull.style.width = (100 * progress) + "%";
        }).then((unityInstance) => {
            window.unityInstance = unityInstance;
            loadingBar.style.display = "none";

            if (fullscreenButton) {
                fullscreenButton.onclick = () => { requestContainerFullscreen(); };
            }

            // NOTE:
            // No rotate/fullscreen overlay is created here.
            // After Firebase auth succeeds, your C# should call:
            //   ShowGateAfterAuthMobile();  // defined in Fullscreen.jslib
            // That function will dynamically create the rotate gate,
            // enable Continue in landscape, and request fullscreen on tap.

        }).catch((message) => {
            alert(message);
        });
    };
    document.body.appendChild(script);
</script>
</body>
</html>
